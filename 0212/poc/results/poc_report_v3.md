# PoC Report v3: 고난도 문제(22번) 검증

> 실험일: 2026-02-10
> 실험자: 고운 편
> 대상 문제: 2024학년도 수능 수학(홀수) 공통 22번 (수학2, 4점)
> API: OpenAI (GPT-5.2), OpenRouter (나머지)

### v2 → v3 변경사항

| 항목 | v2 | v3 |
|------|-----|-----|
| 대상 문제 | 7번 (3점, 도함수 기본) | **22번 (4점, 고난도)** |
| 사용 모델 | 동일 | 동일 (GPT-5.2, Claude Opus 4.5, Gemini 3 Pro, Grok 4, minimax-m2.1) |
| 목적 | 기본 동작 검증 | **고난도 문제에서의 한계 검증** |

---

## 실험 대상 문제

**2024학년도 수능 수학 22번 (단답형, 4점)**

> 최고차항의 계수가 1인 삼차함수 $f(x)$가 다음 조건을 만족시킨다.
>
> (가) $f'(-\frac{1}{4}) = -\frac{1}{4}$
> (나) $f'(\frac{1}{4}) < 0$
> (다) $f(k-1)f(k+1) < 0$을 만족시키는 정수 $k$가 존재하지 않는다.
>
> $f(8)$의 값을 구하시오. 정답: **483**

7번(3점, 도함수 기본) 대비 조건 해석·부호 추론·연립이 필요한 **고난도 문항**이다.

---

## Task 1. 프롬프트 버전별 Step 구조화 품질

3가지 프롬프트로 동일 문제를 **GPT-5.2** (temperature=0.3)에게 풀게 한 뒤, 응답에서 step을 추출하여 구조화 품질을 비교한다.

### 결과

| 버전 | 추출 step 수 | 응답 시간 | 제목 품질 | 정답 도달 |
|------|:-----------:|:---------:|----------|:--------:|
| v1_simple | **39** | 30.4s | 없음 (Part 1~39 fallback) | 미완결 (풀이 도중 포기) |
| v2_step | **44** | 42.4s | Markdown 헤딩 + 구분선 과분할 | 4011/8 (오답) |
| v3_titled | **6 + Final Answer** | 26.0s | 명시적 한국어 제목 | 29295/64 (오답) |

### v1_simple 추출 결과 (GPT-5.2)

파싱 방식: paragraph 분리 (줄바꿈 2개 기준)

```
Part 1~3:   조건 해석 (f(k-1)f(k+1)<0 → f(n)f(n+2)≥0)
Part 5~9:   1) 도함수 조건으로 f'(x) 결정
Part 11~19: 2) "정수 간격 2에서 부호가 바뀌지 않음"의 의미 → 중근 형태 추론
Part 21~27: 3) f'(0)=0 시도 후 모순 → 연속 정수근 형태 시도
Part 29~33: 4) 후보 f(x)=(x-1)²(x+1) 검증 → 탈락
Part 35~39: 결론: "풀이를 완결하지 못함, 원문을 다시 올려달라"
```

- GPT-5.2가 고난도 문제에서 **풀이를 완결하지 못하고 사용자에게 추가 정보를 요청**
- 39개 paragraph로 극심하게 과분할 → 시각화에 사용 불가능

### v2_step 추출 결과 (GPT-5.2)

파싱 방식: Markdown 헤딩 + 번호 패턴

```
## 1) 도함수 조건으로 a,b 구하기
## 2) "정수 k에 대해 f(k-1)f(k+1)<0인 k가 없다"의 의미
## 3) 도함수 조건이 주는 형태: 변곡점 근처 기울기
## 4) 실제로 가능한 해 찾기 (정수근 강제)
## 5) 부호 조건으로 c 결정
## 6) f(8) 계산
```

- 6개 헤딩 구조는 양호하나 구분선(`---`)으로 인해 paragraph fallback 시 44개로 폭증
- 최종 답: $\frac{4011}{8}$ (오답)

### v3_titled 추출 결과 (GPT-5.2)

파싱 방식: `[STEP title="..."]` 마커 기반 정규식 파싱

```
[1] 조건 해석(부호 조건):        정수 격자에서 f(n)f(n+2)≥0 조건 해석
[2] 도함수 조건으로 f'(x) 결정:  b = a/2 - 7/16, a < 1/4 도출
[3] 정수 격자 부호 조건 → 근의 위치 제한: 연속 정수근 또는 중근 형태 추론
[4] 전개하여 a,b를 α로 표현:    f(x)=(x-α)(x-α-1)(x-α-2)
[5] 부등식 f'(1/4)<0로 α 선택:  α=-7/4+√5/2 또는 α=-7/4-√5/2 중 선택
[6] 요구값 f(8) 계산:            (35805-6446√5)/64
[FINAL_ANSWER] (35805-6446√5)/64
```

- 마커 기반 6+1 step으로 깔끔하게 파싱됨
- **포맷 준수율 100%** 유지
- 풀이 전략은 연속 세 정수근 가정 → 무리수 포함 답 (오답)

### 7번 vs 22번 비교 (Task 1)

| 지표 | 7번 (3점) | 22번 (4점) |
|------|:---------:|:----------:|
| v1_simple step 수 | 6 | **39** |
| v2_step step 수 | 13 | **44** |
| v3_titled step 수 | 4+1 | **6+1** |
| v3_titled 응답 시간 | 4.9s | **26.0s** (5.3배) |
| 정답 도달 | 전 버전 정답 | **전 버전 오답** |

### Task 1 결론

> **v3_titled는 고난도 문제에서도 step 구조화에 최적이다.**
> - v1/v2는 어려운 문제에서 step 수가 폭증(39~44개)하여 사실상 사용 불가
> - v3_titled는 6+1로 안정적 파싱 유지
> - 다만, **모든 프롬프트 버전에서 정답에 도달하지 못함** → LLM의 수학 능력 한계가 고난도 문제에서 드러남

---

## Task 2. 코사인 유사도 기반 Step 정렬 검증

v3_titled 프롬프트로 3개 모델(**GPT-5.2, Claude Opus 4.5, Gemini 3 Pro**)의 풀이를 받고, step 간 TF-IDF 코사인 유사도로 정렬한다.

### 모델별 추출된 Step

| # | GPT-5.2 | Claude Opus 4.5 | Gemini 3 Pro |
|:-:|---------|-----------------|--------------|
| 1 | 조건 해석(부호 조건) | 조건 정리 | *(파싱 실패 — 0 step)* |
| 2 | 도함수 조건으로 f'(x) 결정 | 도함수 조건 설정 | |
| 3 | 정수 부호 조건을 만족하는 형태 추론 | a, b 관계 도출 | |
| 4 | 도함수 조건을 (x-m)²(x-n)에 적용 | 극값 조건 분석 | |
| 5 | 정수 m 선택 (부호 조건과 결합) | 근의 위치와 조건 연결 | |
| 6 | 부등식 f'(1/4)<0 확인 | 경계 조건 적용 | |
| 7 | 정수 부호 조건 최종 확인 | f(8) 계산 | |
| 8 | f(8) 계산 | Final Answer | |
| 9 | Final Answer | | |

### 발견된 Alignment Group (2개)

| Group | 포함 모델 | 매칭된 Step | 대표 유사도 |
|:-----:|:---------:|------------|:----------:|
| **G1** | 2/3 | GPT "도함수 조건으로 f'(x) 결정" + "부등식 f'(1/4)<0 확인" ↔ Claude "도함수 조건 설정" + "a,b 관계 도출" + "경계 조건 적용" + "f(8) 계산" | 0.30~0.41 |
| **G2** | 2/3 | GPT "Final Answer" ↔ Claude "Final Answer" | 0.40 |

### 주요 Cross-solution 유사도 (상위)

| 유사도 | Model A - Step | Model B - Step |
|:------:|----------------|----------------|
| 0.411 | GPT "도함수 조건으로 f'(x) 결정" | Claude "a, b 관계 도출" |
| 0.409 | GPT "도함수 조건으로 f'(x) 결정" | Claude "도함수 조건 설정" |
| 0.400 | GPT "Final Answer" | Claude "Final Answer" |
| 0.347 | GPT "부등식 f'(1/4)<0 확인" | Claude "도함수 조건 설정" |
| 0.344 | GPT "부등식 f'(1/4)<0 확인" | Claude "a, b 관계 도출" |
| 0.320 | GPT "도함수 조건으로 f'(x) 결정" | Claude "경계 조건 적용" |

### 7번 vs 22번 비교 (Task 2)

| 지표 | 7번 | 22번 |
|------|:--:|:----:|
| Alignment Group 수 | 4 | **2** |
| 3/3 참여 Group | 2 | **0** |
| Gemini 3 Pro 파싱 | 5 step 정상 | **0 step (실패)** |
| Step 수 범위 | 전원 5 step | **0~9 step** |

### Task 2 결론

> **고난도 문제에서 step 정렬 품질이 현저히 저하된다.**
> - Gemini 3 Pro가 v3_titled 포맷을 준수하지 않아 **0 step 파싱** → 정렬에서 완전 제외
> - GPT-5.2(9 step)와 Claude Opus 4.5(8 step) 간에도 **2개 group만 발견** (7번: 4개)
> - step 제목이 모호하고 모델 간 풀이 전략이 크게 달라 유사도 기반 매칭 한계
> - 고난도 문제에서는 **임베딩 기반 유사도**(semantic similarity) 도입이 필요

---

## Task 3. 단일 모델 다양성 검증

**동일 모델(GPT-5.2)**에 **temperature=1.0**으로 **5회** 반복 추론.

### Run별 추출된 Step

| Run | Step 수 | 풀이 전략 요약 | 최종 답 |
|:---:|:-------:|---------------|:-------:|
| 1 | **10** | 부호조건 → 도함수 → 정수근 t=0 가정 | 460 |
| 2 | **10** | 부호 변화 금지 → 중근 위치 → (x²+px+q)(x+r) 형태 | - |
| 3 | **7** | 부호 변화 금지 → 근 구조 탐색 → 함수 결정 검증 | - |
| 4 | **7** | 부호 변화 금지 → (x²-1)(x-α) 가정 | - |
| 5 | **9** | 부호 조건 → 도함수 → 중근 형태 → 연립 결정 | - |

### Pairwise 풀이 유사도

| | Run 1 | Run 2 | Run 3 | Run 4 | Run 5 |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| Run 1 | - | 0.802 | 0.802 | 0.764 | 0.786 |
| Run 2 | | - | 0.895 | 0.874 | 0.901 |
| Run 3 | | | - | 0.869 | 0.891 |
| Run 4 | | | | - | 0.862 |
| Run 5 | | | | | - |

**평균 pairwise 유사도: 0.845**

### Step-level Alignment

2개 alignment group 발견:
- **G1**: 전체 step이 하나의 mega-group으로 뭉침 (step 수가 7~10으로 달라 1:1 대응 불가)
- **G2**: Final Answer만 별도 그룹 (5/5 참여)

### 7번 vs 22번 비교 (Task 3)

| 지표 | 7번 | 22번 |
|------|:--:|:----:|
| 평균 유사도 | 0.703 | **0.845** |
| Step 수 편차 | 전부 5개 | **7~10개** |
| Alignment Group | 5 (완벽 1:1) | **2 (mega-group)** |

### Task 3 결론

> **고난도 문제에서 단일 모델은 더 높은 유사도(낮은 다양성)를 보인다.**
> - 평균 유사도 **0.845** — 7번(0.703)보다 높음 (다양성 감소)
> - 7번에서는 5회 모두 5 step으로 완벽 수렴했으나, 22번에서는 **7~10 step**으로 편차 발생
> - 풀이 전략 자체는 유사 (조건 해석 → 도함수 → 형태 추론) → 세부 접근만 차이
> - step 구조가 달라 1:1 alignment 불가 → mega-group 형성

---

## Task 4. 다중 모델 다양성 검증

**5개 서로 다른 모델**로 동일 문제를 풀어, 모델 간 풀이 다양성을 확인한다.

### 모델별 추출된 Step

| # | GPT-5.2 | Claude Opus 4.5 | Gemini 3 Pro | Grok 4 | minimax-m2.1 |
|:-:|---------|-----------------|--------------|--------|--------------|
| 1 | 조건 해석(부호 조건) | 조건 분석 | 조건 정리 및 함수 분석 | 함수 형태 정의 | 조건 분석 및 함수 형태 설정 |
| 2 | 도함수 조건 준비 | 삼차함수의 형태 설정 | *(1 step에 전부)* | 도함수 조건 적용 | 도함수 조건 적용 |
| 3 | 조건 f'(-1/4)=-1/4 적용 | 도함수 조건 활용 | | 조건 분석: 뿌리 위치 추정 | 부정조건 분석 |
| 4 | 조건 f'(1/4)<0 로 해 선택 | f'(-1/4)와 f'(1/4) 계산 | | 계수 결정 | 극점 분석 및 근의 위치 추론 |
| 5 | 구하려는 값 f(8) 계산 | 조건 적용 | | 조건 검증 | 조건을 만족하는 특수한 경우 탐색 |
| 6 | Final Answer | 최종 계산 | | f(8) 계산 | 조건을 만족하는 함수 확인 |
| 7 | | Final Answer | | Final Answer | *(Final Answer 누락)* |

### Pairwise 풀이 유사도

| | GPT-5.2 | Claude | Gemini | Grok 4 | minimax |
|------|:-------:|:------:|:------:|:------:|:-------:|
| GPT-5.2 | - | 0.287 | 0.059 | 0.365 | 0.372 |
| Claude | | - | 0.207 | 0.479 | 0.759 |
| Gemini | | | - | 0.139 | 0.229 |
| Grok 4 | | | | - | 0.539 |
| minimax | | | | | - |

**평균 pairwise 유사도: 0.343**

### 발견된 Alignment Group (2개)

| Group | 포함 모델 수 | 매칭 내용 |
|:-----:|:----------:|----------|
| G1 | 5/5 | **도함수/조건 관련 step들** — 풀이 본체가 하나의 mega-group으로 뭉침 |
| G2 | 3/5 | **Final Answer** — GPT-5.2, Claude Opus 4.5, Grok 4만 참여 |

### 모델별 특이사항

| 모델 | Step 수 | 응답 시간 | 비고 |
|------|:-------:|:---------:|------|
| GPT-5.2 | 6 | 22.0s | 간격 2 세 근 가정, 무리수 포함 답 (오답) |
| Claude Opus 4.5 | 7 | 27.4s | 가장 체계적 풀이 구조 |
| Gemini 3 Pro | **1** | 36.7s | **v3 포맷 미준수 → 1 step으로 전체 응답 뭉침** |
| Grok 4 | 7 | **302.4s** (5분) | 가장 긴 응답 시간 |
| minimax-m2.1 | 6 | 97.2s | **Final Answer 마커 누락** |

### 7번 vs 22번 비교 (Task 4)

| 지표 | 7번 | 22번 |
|------|:--:|:----:|
| 평균 유사도 | 0.279 | **0.343** |
| Alignment Group 수 | 3 | **2** |
| 5/5 참여 Group | 3 | **1** |
| Gemini 파싱 | 5 step 정상 | **1 step (실패)** |
| minimax Final Answer | 있음 | **누락** |
| Grok 4 응답 시간 | 15.8s | **302.4s** |
| Step 수 범위 | 4~6 | **1~7** |

### Task 4 결론

> **고난도 문제에서 다중 모델 전략의 다양성은 유지되나, 정렬 품질은 저하된다.**
> - 평균 유사도 **0.343** — 7번(0.279)보다 약간 높지만 여전히 충분히 다양
> - Gemini 3 Pro가 **v3 포맷을 미준수**하여 정렬에서 사실상 제외
> - minimax-m2.1이 **Final Answer 마커를 누락**하여 G2에서 제외
> - Grok 4의 응답 시간이 **302초(5분)**로 실시간 데모에 부적합
> - GPT-5.2 ↔ Gemini 3 Pro 유사도가 **0.059**로 극단적으로 낮음

---

## 종합 결론: 쉬운 문제 vs 어려운 문제

### 전체 비교 요약

| 지표 | 7번 (3점, 쉬움) | 22번 (4점, 어려움) | 변화 |
|------|:--------------:|:-----------------:|:----:|
| v3_titled step 수 (Task 1) | 4+1 | 6+1 | +50% |
| v3_titled 응답 시간 (Task 1) | 4.9s | 26.0s | **5.3배** |
| 정답 도달률 (Task 1) | 3/3 | 0/3 | **전멸** |
| Task 2 Alignment Group | 4 | 2 | **-50%** |
| Task 2 전원 참여 Group | 2 | 0 | **-100%** |
| Task 3 평균 유사도 | 0.703 | 0.845 | +20% (다양성↓) |
| Task 3 Step 수 편차 | 0 (전부 5) | 3 (7~10) | **불안정** |
| Task 4 평균 유사도 | 0.279 | 0.343 | +23% |
| Task 4 Alignment Group | 3 | 2 | -33% |
| Gemini 포맷 준수 | O | **X** | 실패 |
| Grok 4 응답 시간 | 15.8s | 302.4s | **19배** |

### 핵심 발견

1. **v3_titled 프롬프트는 고난도에서도 유효하나, 일부 모델에서 포맷 준수 실패**
   - Gemini 3 Pro: thinking 모델 특성상 마커 생성 실패 → fallback 파싱 필수
   - minimax-m2.1: Final Answer 누락 → 후처리 보완 필요

2. **정렬 품질은 문제 난이도에 반비례**
   - 어려운 문제 → 풀이 전략 분화 → step 구조 불일치 → mega-group 형성
   - TF-IDF char n-gram 유사도만으로는 의미적 대응 한계

3. **정답률 급락은 시스템 설계에 시사점 제공**
   - 고난도 문제에서 LLM 정답률이 크게 떨어짐
   - "정답 제시"보다 "다양한 풀이 비교·시각화"에 시스템 가치 부각

4. **응답 시간 편차 심화**
   - Grok 4가 22번에서 302초 (7번의 19배) → 타임아웃 및 스트리밍 UX 설계 필요

### 대응 방안

| 문제점 | 대응 방안 | 우선순위 |
|--------|----------|:--------:|
| Gemini v3 포맷 미준수 | Markdown 헤딩/번호 패턴 fallback 파싱 강화 | 높음 |
| minimax Final Answer 누락 | 응답 마지막 단락 자동 추정 로직 | 높음 |
| Mega-group 형성 | 임베딩 기반 유사도 도입 (sentence-transformers) | 중간 |
| Grok 4 응답 시간 302초 | 모델별 타임아웃 설정 + 스트리밍 중간 결과 표시 | 높음 |
| LLM 정답률 저하 | 다중 모델 비교 시각화로 사용자 판단 지원 | 중간 |
| Step 수 편차 (7~10) | 동적 레이아웃 + step 수 무관 alignment 알고리즘 | 중간 |
