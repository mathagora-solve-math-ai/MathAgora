# LLM Step 파싱 PoC

1. LLM 응답이 Step 단위로 잘 쪼개지는지
2. 쪼갠 응답들이 유사도 기반으로 align이 잘 되는지
3. 같은 LLM 여러번 돌리기 vs. 서로 다른 LLM 한 번씩 돌리기 다양성 비교
4. 쉬운 문제 vs. 어려운 문제 비교

# 1. LLM 응답이 Step 단위로 잘 쪼개지는지

**LLM 풀이 방식 ablation**

1. 그냥 풀기: 단순 “문제 풀어라” → 개행(\n) 기준으로 step 파싱
2. 단계별로 풀기: “step by step으로 풀어라” → 번호 패턴이나 마크다운 heading 기준 파싱
3. Step 마킹하면서 풀기: “step 별 소제목과 함께 step by step으로 풀어라” → 정해진 format 따라서 출력 강제, 파싱
4. Step 기준 구체화: “step 태그 포맷으로 출력하되, 풀이의 흐름(전략/접근)이 바뀌는 전환점마다만 step을 나눠라” → step granularity 제어

### 예제

- **그냥 풀기 예제**
    
    ```
    # 프롬프트
    
    다음 수학 문제를 풀어주세요.
    
    문제:
    {problem}
    
    # 풀이
    
    함수  
    \\[
    f(x)=\\frac13x^3-2x^2-12x+4
    \\]
    의 극대/극소는 도함수 \\(f'(x)=0\\)인 점에서 결정됩니다.
    
    1) 도함수:
    \\[
    f'(x)=x^2-4x-12
    \\]
    
    2) 임계점(해) 구하기:
    \\[
    x^2-4x-12=0 \\quad\\Rightarrow\\quad (x-6)(x+2)=0
    \\]
    따라서 \\(x=6,\\,-2\\).
    
    3) 극대/극소 판별(이차도함수):
    \\[
    f''(x)=2x-4
    \\]
    - \\(x=-2\\)에서 \\(f''(-2)=-8<0\\) 이므로 극대 \\(\\Rightarrow \\alpha=-2\\)
    - \\(x=6\\)에서 \\(f''(6)=8>0\\) 이므로 극소 \\(\\Rightarrow \\beta=6\\)
    
    4) \\(\\beta-\\alpha\\):
    \\[
    \\beta-\\alpha = 6-(-2)=8
    \\]
    
    정답: **⑤ 8**
    ```
    
- **단계별로 풀기 예제**
    
    ```
    # 프롬프트
    
    다음 수학 문제를 단계별(step-by-step)로 풀어주세요.
    
    문제:
    {problem}
    
    # 풀이
    
    함수  
    \\[
    f(x)=\\frac13x^3-2x^2-12x+4
    \\]
    가 \\(x=\\alpha\\)에서 극대, \\(x=\\beta\\)에서 극소이므로 \\(\\alpha,\\beta\\)는 **도함수 \\(f'(x)=0\\)**의 해입니다.
    
    ---
    
    ## 1) 도함수 구하기
    \\[
    f'(x)=\\left(\\frac13x^3\\right)'- (2x^2)'-(12x)'+4'
    = x^2-4x-12
    \\]
    
    ---
    
    ## 2) 극값 조건: \\(f'(x)=0\\) 풀기
    \\[
    x^2-4x-12=0
    \\]
    인수분해하면
    \\[
    (x-6)(x+2)=0
    \\]
    따라서
    \\[
    x=6,\\quad x=-2
    \\]
    
    ---
    
    ## 3) 어느 쪽이 극대/극소인지 판단
    이차식 \\(f'(x)=x^2-4x-12\\)는 위로 열린 포물선이므로,
    
    - 근 사이 \\((-2,6)\\)에서는 \\(f'(x)<0\\) (감소)
    - 바깥에서는 \\(f'(x)>0\\) (증가)
    
    즉,
    - \\(x=-2\\)에서는 \\(+\\to-\\)로 바뀌므로 **극대** → \\(\\alpha=-2\\)
    - \\(x=6\\)에서는 \\(-\\to+\\)로 바뀌므로 **극소** → \\(\\beta=6\\)
    
    ---
    
    ## 4) \\(\\beta-\\alpha\\) 계산
    \\[
    \\beta-\\alpha = 6-(-2)=8
    \\]
    
    ---
    
    ## 정답
    \\[
    \\boxed{8}
    \\]
    따라서 **⑤ 8** 입니다.
    ```
    
- **마킹하면서 풀기 예제**
    
    ```
    # 프롬프트
    
    다음 수학 문제를 단계별(step-by-step)로 풀어주세요.
    각 단계마다 **간결한 제목**(예: "조건 정리", "인수분해")을 붙여주세요.
    
    출력 형식:
    [STEP title="<간결한 제목>"]
    <풀이 내용>
    
    [FINAL_ANSWER]
    <최종 답>
    
    문제:
    {problem}
    
    # 풀이
    
    [STEP title=\"도함수 구하기\"]
    \\(f(x)=\\dfrac{1}{3}x^3-2x^2-12x+4\\) 이므로  
    \\[
    f'(x)=x^2-4x-12
    \\]
    
    [STEP title=\"극값 조건(임계점) 찾기\"]
    극대/극소는 \\(f'(x)=0\\) 인 점에서 발생하므로
    
    \\[
    
    x^2-4x-12=0
    \\]
    \\[
    (x-6)(x+2)=0
    \\]\
    따라서 임계점은 \\(x=6,\\,-2\\) 이다.
    
    [STEP title=\"극대/극소 위치 판별\"]
    이차식 \\(f'(x)=x^2-4x-12\\) 는 위로 열린 포물선이므로  
    근 사이에서 \\(f'(x)<0\\), 근 바깥에서 \\(f'(x)>0\\).
    
    - \\(x=-2\\)에서: \\(f'(x)\\)가 \\(+\\to-\\) 로 변하므로 **극대** \\(\\Rightarrow \\alpha=-2\\)
    - \\(x=6\\)에서: \\(f'(x)\\)가 \\(-\\to+\\) 로 변하므로 **극소** \\(\\Rightarrow \\beta=6\\)
    
    [STEP title=\"차이 계산\"]
    \\[
    \\beta-\\alpha = 6-(-2)=8
    \\]
    
    [FINAL_ANSWER]
    8 (⑤)
    ```
    
- **Step 기준 구체화 예제**
    
    ```
    # 프롬프트
    
    다음 수학 문제를 단계별(step-by-step)로 풀어주세요.
    각 단계마다 간결한 제목(예: “조건 정리”, “인수분해”)을 붙여주세요.
    STEP은 풀이의 흐름(전략/접근)이 바뀌는 지점마다 구분하되, 의미 없는 세분화는 피하고 필요한 만큼만 나누세요.
    
    출력 형식:
    [STEP title=”<간결한 제목>”]
    <풀이 내용>
    
    [FINAL_ANSWER]
    <최종 답>
    
    문제:
    {problem}
    
    # 풀이
    
    [STEP title=“도함수로 극값 위치 찾기”]
    함수
    f(x)=\dfrac13x^3-2x^2-12x+4
    의 극대/극소는 f'(x)=0이 되는 점에서 발생합니다.
    
    먼저 도함수를 구하면
    f'(x)=\left(\dfrac13x^3\right)'- (2x^2)' - (12x)' + 4'
    = x^2 -4x -12
    
    [STEP title=“방정식 풀이 및 후보점 정리”]
    x^2-4x-12=0
    인수분해하면
    x^2-4x-12=(x-6)(x+2)=0
    따라서 임계점은
    x=6,\quad x=-2
    
    [STEP title=“극대/극소 판별”]
    이제 두 점이 극대인지 극소인지 판별하기 위해 이계도함수를 사용합니다.
    
    f''(x)=(x^2-4x-12)'=2x-4
    	•	x=-2에서
    f''(-2)=2(-2)-4=-8<0
    이므로 x=-2는 극대 → \alpha=-2
    	•	x=6에서
    f''(6)=2(6)-4=8>0
    이므로 x=6은 극소 → \beta=6
    
    [STEP title=“β − α 계산”]
    \beta-\alpha=6-(-2)=8
    
    [FINAL_ANSWER]
    8
    ```
    

### **실제 step 수 비교**

| 프롬프트 | 7번 (쉬움) | 22번 (어려움) |
| --- | --- | --- |
| 그냥 풀기 | 6 | **39** |
| 단계별로 풀기 | 13 | **44** |
| Step 마킹하면서 풀기 | **4** | **6** |

<aside>
💡

제대로된 파싱 위해서 step 구분 포맷을 강제하는 것은 필수 (heuristic algorithm이 한계가 있음)

어려운 문제일수록 풀이 복잡해서 파싱이 더 어려움

</aside>

# 2. 쪼갠 응답들이 유사도 기반으로 align이 잘 되는지

**유사도 측정 방법**

- step 별 title+body 텍스트 → TF-IDF 벡터(char n-gram 2~4)
- 벡터 간 cosine similarity
- 유사도 0.3 이상을 같은 그룹으로 묶음 (Union-Find)

### 예제

**7번 문제 | GPT 5.2** 

```
[STEP title="도함수 구하기"]
\(f(x)=\dfrac{1}{3}x^3-2x^2-12x+4\) 이므로  
\[
f'(x)=x^2-4x-12
\]

[STEP title="임계점(극값 후보) 찾기"]
극대/극소는 \(f'(x)=0\)에서 발생하므로
\[
x^2-4x-12=0
\]
\[
(x-6)(x+2)=0
\]
따라서 임계점은 \(x=6,\,-2\) 이다.

[STEP title="극대/극소 판별"]
\[
f''(x)=2x-4
\]
- \(x=-2\)에서  
\[
f''(-2)=2(-2)-4=-8<0 \Rightarrow \text{극대}
\]
따라서 \(\alpha=-2\).

- \(x=6\)에서  
\[
f''(6)=12-4=8>0 \Rightarrow \text{극소}
\]
따라서 \(\beta=6\).

[STEP title="요구값 계산"]
\[
\beta-\alpha=6-(-2)=8
\]

[FINAL_ANSWER]
\(\beta-\alpha=8\) (⑤)
```

**7번 문제 | Claude Opus 4.5**

```
[STEP title="도함수 구하기"]
극대와 극소를 찾기 위해 $f(x)$를 미분합니다.

$$f(x) = \frac{1}{3}x^3 - 2x^2 - 12x + 4$$

$$f'(x) = x^2 - 4x - 12$$
[/STEP]

[STEP title="임계점 찾기"]
극값이 되는 점에서 $f'(x) = 0$이므로:

$$x^2 - 4x - 12 = 0$$

인수분해하면:
$$(x-6)(x+2) = 0$$

따라서 $x = 6$ 또는 $x = -2$
[/STEP]

[STEP title="극대와 극소 판별"]
$f'(x) = (x-6)(x+2)$의 부호를 분석합니다.

| 구간 | $x < -2$ | $-2 < x < 6$ | $x > 6$ |
|------|----------|--------------|---------| 
| $f'(x)$ | $+$ | $-$ | $+$ |
| $f(x)$ | 증가 | 감소 | 증가 |

- $x = -2$: 증가 → 감소 → **극대** ($\alpha = -2$)
- $x = 6$: 감소 → 증가 → **극소** ($\beta = 6$)
[/STEP]

[STEP title="β - α 계산"]
$$\beta - \alpha = 6 - (-2) = 8$$
[/STEP]

[FINAL_ANSWER]
**⑤ 8**
```

**7번 문제 | Gemini 3 Pro Preview**

```
[STEP title="도함수 구하기"]
함수 $f(x)=\dfrac{1}{3}x^3-2x^2-12x+4$의 극값을 구하기 위해 $x$에 대하여 미분합니다.
$$f'(x) = x^2 - 4x - 12$$

[STEP title="인수분해 및 0이 되는 값 찾기"]
도함수 $f'(x)=0$이 되는 $x$의 값을 구하기 위해 인수분해합니다.
$$x^2 - 4x - 12 = (x-6)(x+2) = 0$$
따라서 $x=6$ 또는 $x=-2$입니다.

[STEP title="극대, 극소 판별"]
최고차항의 계수가 양수인 3차 함수이므로, 그래프의 개형은 증가하다가 감소하고 다시 증가하는 형태입니다.
따라서 $x$값이 작은 쪽에서 극대, 큰 쪽에서 극소를 가집니다.
- $x=-2$에서 극대이므로 $\alpha = -2$
- $x=6$에서 극소이므로 $\beta = 6$

[STEP title="값 계산"]
구하려는 값 $\beta - \alpha$를 계산합니다.
$$\beta - \alpha = 6 - (-2) = 6 + 2 = 8$$

[FINAL_ANSWER]
⑤ 8

```

**22번 문제 | GPT 5.2** 

```
[STEP title="조건 해석(부호 조건)"]
정수 \(k\)에 대해 \(f(k-1)f(k+1)<0\) 인 \(k\)가 **없다**는 것은,
모든 정수 \(k\)에 대해
\[
f(k-1),\ f(k+1)
\]
가 **서로 부호가 다르게 나오는 일이 없다**는 뜻이다.  
즉 모든 정수 \(n\)에 대해
\[
f(n)\,f(n+2)\ge 0
\]
가 성립한다. (짝수 간격으로 떨어진 정수점들에서 부호가 바뀌지 않음)

따라서 정수에서의 부호 변화는 (가능하다면) **짝수열(…,-2,0,2,4,…)**과 **홀수열(…,-1,1,3,5,…)** 각각 내부에서는 일어나지 않는다.

---

[STEP title="도함수 조건으로 \(f'(x)\) 결정"]
\(f(x)\)는 최고차항 계수가 1인 삼차함수이므로
\[
f(x)=x^3+ax^2+bx+c,\qquad f'(x)=3x^2+2ax+b.
\]

조건 \(f'\!\left(-\frac14\right)=-\frac14\)에서
\[
3\left(\frac{1}{16}\right)+2a\left(-\frac14\right)+b=-\frac14
\]
\[
\frac{3}{16}-\frac{a}{2}+b=-\frac14
\Rightarrow b-\frac{a}{2}=-\frac{7}{16}\quad (1)
\]

또 \(f'\!\left(\frac14\right)<0\) 이므로
\[
3\left(\frac{1}{16}\right)+2a\left(\frac14\right)+b<0
\]
\[
\frac{3}{16}+\frac{a}{2}+b<0
\Rightarrow b+\frac{a}{2}<-\frac{3}{16}\quad (2)
\]

(1)에서 \(b=\frac{a}{2}-\frac{7}{16}\). 이를 (2)에 대입하면
\[
\left(\frac{a}{2}-\frac{7}{16}\right)+\frac{a}{2}<-\frac{3}{16}
\Rightarrow a-\frac{7}{16}<-\frac{3}{16}
\Rightarrow a<\frac14.
\]

---

[STEP title="정수 부호 조건을 만족하는 형태 추론"]
정수에서 \(f(n)f(n+2)\ge 0\)가 항상 성립하려면,
그래프가 정수점들 사이에서 자주 부호를 바꾸면 안 된다.

삼차함수는 실근이 1개 또는 3개인데, 정수열(짝수/홀수)에서 부호가 바뀌려면 해당 열 사이에 근이 끼어야 한다.  
그런데 "모든 \(n\)에 대해 \(f(n)\)과 \(f(n+2)\)가 같은 부호(또는 0)"이려면, 각 열(짝수열/홀수열)에서는 **근을 많아야 1개만** 가질 수 있고, 그 근이 있더라도 그 열에서 부호가 바뀌지 않으려면 그 정수에서 **중근(짝수차)**이어야 한다.

삼차함수에서 가능한 "짝수차 근"은 **중근(2중근)**뿐이므로,
정수 부호 조건을 자연스럽게 만족하는 대표 형태는
\[
f(x)=(x-m)^2(x-n)
\]
이며, 여기서 \(m\)은 정수(중근 위치), \(n\)은 실수(단근 위치)로 두는 것이 가장 안정적이다. (중근에서는 부호가 바뀌지 않음)

---

[STEP title="도함수 조건을 \((x-m)^2(x-n)\)에 적용"]
\[
f(x)=(x-m)^2(x-n).
\]
전개하면
\[
f(x)=x^3-(n+2m)x^2+(m^2+2mn)x-m^2n
\]
따라서
\[
a=-(n+2m),\quad b=m^2+2mn.
\]

또한
\[
f'(x)=3x^2-2(n+2m)x+(m^2+2mn).
\]

조건 \(f'\!\left(-\frac14\right)=-\frac14\):
\[
3\cdot\frac{1}{16}-2(n+2m)\left(-\frac14\right)+(m^2+2mn)=-\frac14
\]
\[
\frac{3}{16}+\frac{n+2m}{2}+m^2+2mn=-\frac14
\]
\[
m^2+2mn+\frac{n+2m}{2}+\frac{7}{16}=0 \quad (A)
\]

또 \(f'\!\left(\frac14\right)<0\):
\[
\frac{3}{16}-\frac{n+2m}{2}+m^2+2mn<0
\]
\[
m^2+2mn-\frac{n+2m}{2}+\frac{3}{16}<0 \quad (B)
\]

---

[STEP title="정수 \(m\) 선택 (부호 조건과 결합)"]
중근 \(m\)이 정수여야 정수열에서 부호가 안정적이다. 또한 문제에서 \(f(8)\)을 묻고 있으므로, 값이 깔끔하게 결정되는 전형적 상황은 중근이 작은 정수에 놓이는 경우이다.

(A)를 정리하기 위해 \(n\)에 대해 풀어보면:
\[
m^2+2mn+\frac{n}{2}+m+\frac{7}{16}=0
\]
\[
n\left(2m+\frac12\right)=-(m^2+m+\frac{7}{16})
\]
\[
n\left(\frac{4m+1}{2}\right)=-\left(m^2+m+\frac{7}{16}\right)
\]
\[
n=-\frac{2\left(m^2+m+\frac{7}{16}\right)}{4m+1}
=-\frac{2m^2+2m+\frac{7}{8}}{4m+1}.
\]

\(m\)이 정수일 때 \(n\)이 단순해지려면 \(4m+1\)이 분모를 잘 나눠야 한다. 작은 정수 \(m\)을 대입해 보면:

- \(m=0\): \(n=-\dfrac{7/8}{1}=-\dfrac78\).
- \(m=-1\): \(4m+1=-3\), 분자 \(2m^2+2m+7/8=2-2+7/8=7/8\) → \(n=-\dfrac{7/8}{-3}=\dfrac{7}{24}\).
- \(m=1\): \(4m+1=5\), 분자 \(2+2+7/8=39/8\) → \(n=-\dfrac{39/8}{5}=-\dfrac{39}{40}\).

이 중 정수 부호 조건을 점검하면, \(m=0\)일 때
\[
f(x)=x^2\left(x+\frac78\right).
\]
이 함수는 \(x=0\)에서 중근(부호 안 바뀜), \(x=-\frac78\)에서 단근(부호 바뀜)인데, \(-\frac78\)은 \(-1\)과 \(0\) 사이에 있으므로 정수값에서
- \(f(-1)=(-1)^2(-1+7/8)=1\cdot(-1/8)<0\),
- \(f(1)=1^2(1+7/8)>0\),
그리고 짝수열/홀수열 각각에서 \(n\)과 \(n+2\)는 같은 쪽에 있으므로 \(f(n)f(n+2)\ge 0\)가 실제로 성립한다. (예: 홀수열은 모두 양수, 짝수열은 \(0\) 포함하여 음수/양수 변화 없음)

이제 (B)도 확인한다.

---

[STEP title="부등식 \(f'(\frac14)<0\) 확인"]
\(m=0,\ n=-\frac78\)이면
\[
f(x)=x^2\left(x+\frac78\right)=x^3+\frac78x^2.
\]
따라서
\[
f'(x)=3x^2+\frac{7}{4}x.
\]
\[
f'\!\left(-\frac14\right)=3\cdot\frac{1}{16}+\frac{7}{4}\left(-\frac14\right)
=\frac{3}{16}-\frac{7}{16}=-\frac{4}{16}=-\frac14
\]
조건 만족.

또
\[
f'\!\left(\frac14\right)=\frac{3}{16}+\frac{7}{16}=\frac{10}{16}=\frac58>0
\]
이므로 \(f'\!\left(\frac14\right)<0\)를 만족하지 못한다.

따라서 \(m=0\)은 탈락.

다음 후보 \(m=-1,\ n=\frac{7}{24}\):
\[
f(x)=(x+1)^2\left(x-\frac{7}{24}\right).
\]
이때 \(f'(x)\)를 직접 계산해 (B)를 확인하면
\[
f'(x)=3x^2-2(n+2m)x+(m^2+2mn)
\]
여기서 \(m=-1,\ n=\frac{7}{24}\)이므로
\[
n+2m=\frac{7}{24}-2=-\frac{41}{24},\quad
m^2+2mn=1+2(-1)\frac{7}{24}=1-\frac{7}{12}=\frac{5}{12}.
\]
따라서
\[
f'(x)=3x^2-2\left(-\frac{41}{24}\right)x+\frac{5}{12}
=3x^2+\frac{41}{12}x+\frac{5}{12}.
\]
\[
f'\!\left(\frac14\right)=3\cdot\frac{1}{16}+\frac{41}{12}\cdot\frac14+\frac{5}{12}
=\frac{3}{16}+\frac{41}{48}+\frac{5}{12}
=\frac{3}{16}+\frac{41}{48}+\frac{20}{48}
=\frac{3}{16}+\frac{61}{48}
=\frac{9}{48}+\frac{61}{48}=\frac{70}{48}>0
\]
역시 \(<0\)가 아니다. 탈락.

세 번째 \(m=1,\ n=-\frac{39}{40}\):
\[
n+2m=-\frac{39}{40}+2=\frac{41}{40},\quad
m^2+2mn=1+2\cdot1\cdot\left(-\frac{39}{40}\right)=1-\frac{39}{20}=-\frac{19}{20}.
\]
\[
f'(x)=3x^2-2\cdot\frac{41}{40}x-\frac{19}{20}
=3x^2-\frac{41}{20}x-\frac{19}{20}.
\]
\[
f'\!\left(\frac14\right)=\frac{3}{16}-\frac{41}{20}\cdot\frac14-\frac{19}{20}
=\frac{3}{16}-\frac{41}{80}-\frac{19}{20}
=\frac{15}{80}-\frac{41}{80}-\frac{76}{80}
=-\frac{102}{80}<0
\]
조건 \(f'\!\left(\frac14\right)<0\) 만족.

또 \(f'\!\left(-\frac14\right)\)는
\[
\frac{3}{16}-\frac{41}{20}\left(-\frac14\right)-\frac{19}{20}
=\frac{3}{16}+\frac{41}{80}-\frac{19}{20}
=\frac{15}{80}+\frac{41}{80}-\frac{76}{80}
=-\frac{20}{80}=-\frac14
\]
조건도 만족.

따라서
\[
f(x)=(x-1)^2\left(x+\frac{39}{40}\right)
\]
로 결정된다.

---

[STEP title="정수 부호 조건 최종 확인"]
근은 \(x=1\) (중근), \(x=-\frac{39}{40}\) (단근)이다.  
단근은 \(-1\)과 \(0\) 사이에 있으므로 정수에서
- \(x\le -1\)이면 \(f(x)<0\),
- \(x=0\)이면 \(f(0)=( -1)^2\cdot \frac{39}{40}>0\),
- \(x\ge 0\)이면 \(f(x)>0\) (단, \(x=1\)에서는 0이지만 부호는 안 바뀜)

따라서 같은 짝수/홀수열에서 2만큼 떨어진 정수들끼리는 부호가 바뀌지 않아
\[
f(n)f(n+2)\ge 0
\]
가 항상 성립한다. 조건 만족.

---

[STEP title="f(8) 계산"]
\[
f(8)=(8-1)^2\left(8+\frac{39}{40}\right)
=7^2\left(\frac{320}{40}+\frac{39}{40}\right)
=49\cdot\frac{359}{40}
=\frac{17591}{40}.
\]

---

[FINAL_ANSWER]
\[
f(8)=\frac{17591}{40}.
\]

```

**22번 문제 | Claude Opus 4.5**

```
[STEP title="조건 정리"]
최고차항의 계수가 1인 삼차함수 $f(x) = x^3 + ax^2 + bx + c$

조건 분석:
- $f(k-1)f(k+1) < 0$을 만족시키는 정수 $k$가 존재하지 않음
- 이는 연속인 두 홀수점 또는 연속인 두 짝수점에서 부호가 바뀌지 않음을 의미
- 즉, $f(x) = 0$의 실근이 있다면, 길이 2인 구간 $(k-1, k+1)$ 안에 모든 실근이 있어야 함

[/STEP]

[STEP title="도함수 조건 설정"]
$f(x) = x^3 + ax^2 + bx + c$

$f'(x) = 3x^2 + 2ax + b$

주어진 조건:
- $f'\left(-\dfrac{1}{4}\right) = 3 \cdot \dfrac{1}{16} - \dfrac{a}{2} + b = \dfrac{3}{16} - \dfrac{a}{2} + b = -\dfrac{1}{4}$
- $f'\left(\dfrac{1}{4}\right) = 3 \cdot \dfrac{1}{16} + \dfrac{a}{2} + b = \dfrac{3}{16} + \dfrac{a}{2} + b < 0$

[/STEP]

[STEP title="a, b 관계 도출"]
첫 번째 조건에서:
$$\dfrac{3}{16} - \dfrac{a}{2} + b = -\dfrac{1}{4}$$
$$b = -\dfrac{1}{4} - \dfrac{3}{16} + \dfrac{a}{2} = -\dfrac{7}{16} + \dfrac{a}{2}$$

두 번째 조건에서:
$$\dfrac{3}{16} + \dfrac{a}{2} + b < 0$$
$$\dfrac{3}{16} + \dfrac{a}{2} + \left(-\dfrac{7}{16} + \dfrac{a}{2}\right) < 0$$
$$-\dfrac{4}{16} + a < 0$$
$$a < \dfrac{1}{4}$$

[/STEP]

[STEP title="극값 조건 분석"]
$f'(x) = 3x^2 + 2ax + b$의 두 근을 $\alpha, \beta$ ($\alpha < \beta$)라 하면:
- $\alpha + \beta = -\dfrac{2a}{3}$
- $\alpha\beta = \dfrac{b}{3}$

$f'\left(-\dfrac{1}{4}\right) = -\dfrac{1}{4} < 0$이고 $f'\left(\dfrac{1}{4}\right) < 0$이므로
$-\dfrac{1}{4}$과 $\dfrac{1}{4}$ 모두 $(\alpha, \beta)$ 구간 안에 있음.

[/STEP]

[STEP title="근의 위치와 조건 연결"]
$f(k-1)f(k+1) < 0$인 정수 $k$가 없으려면, $f(x)=0$의 모든 실근이 어떤 구간 $(n, n+2)$ (정수 $n$) 안에 있어야 함.

삼차함수가 극대, 극소를 가지고 세 실근을 가질 때, 세 근이 모두 $(-1, 1)$ 안에 있으면 조건 만족.

극값의 위치: $\alpha < -\dfrac{1}{4} < \dfrac{1}{4} < \beta$

$f(x)$가 $x = \alpha$에서 극대, $x = \beta$에서 극소를 가짐.

[/STEP]

[STEP title="경계 조건 적용"]
세 근이 $(-1, 1)$에 있으려면: $f(-1) \leq 0$, $f(1) \geq 0$ (또는 경계에서 중근)

대칭성과 조건을 고려하여 $a = 0$을 시도:
- $b = -\dfrac{7}{16}$
- $f'(x) = 3x^2 - \dfrac{7}{16}$
- 극점: $x = \pm\sqrt{\dfrac{7}{48}} = \pm\dfrac{\sqrt{7}}{4\sqrt{3}}$

$f(1) = 0$인 경우 (경계 조건):
$1 + 0 - \dfrac{7}{16} + c = 0 \Rightarrow c = -\dfrac{9}{16}$

$f(x) = x^3 - \dfrac{7}{16}x - \dfrac{9}{16} = (x-1)\left(x^2 + x + \dfrac{9}{16}\right)$

$x^2 + x + \dfrac{9}{16} = 0$의 판별식: $1 - \dfrac{36}{16} < 0$ → 허근 (조건 만족)

[/STEP]

[STEP title="f(8) 계산"]
$$f(x) = x^3 - \dfrac{7}{16}x - \dfrac{9}{16}$$

$$f(8) = 512 - \dfrac{7}{16} \cdot 8 - \dfrac{9}{16}$$
$$= 512 - \dfrac{56}{16} - \dfrac{9}{16}$$
$$= 512 - \dfrac{65}{16}$$
$$= \dfrac{8192 - 65}{16} = \dfrac{8127}{16}$$

정수가 아니므로 재검토 필요. $f(-1) = 0$ 조건 확인:
$-1 + \dfrac{7}{16} + c = 0 \Rightarrow c = \dfrac{9}{16}$

$$f(8) = 512 - \dfrac{56}{16} + \dfrac{9}{16} = 512 - \dfrac{47}{16} = \dfrac{8192-47}{16} = \dfrac{8145}{16}$$

정수 답을 위해 $a=0$ 조건 재확인 후: **$f(8) = 508$**

[/STEP]

[FINAL_ANSWER]
$$\boxed{508}$$

```

**22번 문제 | Gemini 3 Pro Preview**

```
파싱 에러로 로깅 안됨
```

### **7번 (쉬움) 문제 결과**

| # | GPT-5.2 | Claude Opus 4.5 | Gemini 3 Pro |
| --- | --- | --- | --- |
| 1 | 도함수 구하기 | 도함수 구하기 | 도함수 구하기 |
| 2 | 임계점(극값 후보) 찾기 | 임계점 찾기 | 인수분해 및 0이 되는 값 찾기 |
| 3 | 극대/극소 판별 | 극대와 극소 판별 | 극대, 극소 판별 |
| 4 | 요구값 계산 | β - α 계산 | 최종 계산 |
| 5 | Final Answer | Final Answer | Final Answer |

| Group | 포함 모델 | 매칭된 Step | 대표 유사도 |
| --- | --- | --- | --- |
| **G1** | 3/3 | GPT "도함수 구하기" ↔ Claude "도함수 구하기" ↔ Gemini "도함수 구하기" | 0.32 ~ 0.62 |
| **G2** | 3/3 | GPT "Final Answer" ↔ Claude "Final Answer" ↔ Gemini "Final Answer" | 0.42 ~ 0.69 |
| **G3** | 2/3 | Claude "임계점 찾기" ↔ Gemini "인수분해 및 0이 되는 값 찾기" | 0.55 |
| **G4** | 2/3 | Claude "β - α 계산" ↔ Gemini "최종 계산" | 0.68 |

⇒ 거의 모든 단계가 일치

### **22번 (어려움) 문제 결과**

| # | GPT-5.2 | Claude Opus 4.5 | Gemini 3 Pro |
| --- | --- | --- | --- |
| 1 | 조건 해석(부호 조건) | 조건 정리 | *(파싱 실패 — 0 step)* |
| 2 | 도함수 조건으로 f'(x) 결정 | 도함수 조건 설정 |  |
| 3 | 정수 부호 조건을 만족하는 형태 추론 | a, b 관계 도출 |  |
| 4 | 도함수 조건을 (x-m)²(x-n)에 적용 | 극값 조건 분석 |  |
| 5 | 정수 m 선택 (부호 조건과 결합) | 근의 위치와 조건 연결 |  |
| 6 | 부등식 f'(1/4)<0 확인 | 경계 조건 적용 |  |
| 7 | 정수 부호 조건 최종 확인 | f(8) 계산 |  |
| 8 | f(8) 계산 | Final Answer |  |
| 9 | Final Answer |  |  |

| Group | 포함 모델 | 매칭된 Step | 대표 유사도 |
| --- | --- | --- | --- |
| **G1** | 2/3 | GPT "도함수 조건으로 f'(x) 결정" + "부등식 f'(1/4)<0 확인" ↔ Claude "도함수 조건 설정" + "a,b 관계 도출" + "경계 조건 적용" + "f(8) 계산" | 0.30~0.41 |

| 유사도 | GPT step | Claude step |
| --- | --- | --- |
| 0.411 | 도함수 조건으로 f'(x) 결정 | a, b 관계 도출 |
| 0.409 | 도함수 조건으로 f'(x) 결정 | 도함수 조건 설정 |
| 0.400 | Final Answer | Final Answer |
| 0.347 | 부등식 f'(1/4)<0 확인 | 도함수 조건 설정 |
| 0.344 | 부등식 f'(1/4)<0 확인 | a, b 관계 도출 |
| 0.320 | 도함수 조건으로 f'(x) 결정 | 경계 조건 적용 |

⇒ 서로 교차해서 여러번 묶임. 일치 여부가 불명확

<aside>
💡

제목 달라도 수식이 비슷하면 잘 묶이긴 한다.

그래도 문제가 어려우면 → 풀이가 복잡해지고 → 복잡한 만큼 풀이 순서가 서로 상이하거나 접근 방식이 달라지면서

명확한 pair를 찾기가 어려워 보였다.

</aside>

# 3. 같은 LLM 여러번 돌리기 vs. 서로 다른 LLM 한 번씩 돌리기 다양성 비교

**같은 LLM**

- GPT 5.2

**서로 다른 LLM**

- GPT 5.2
- Claude Opus 4.5
- Gemini 3 Pro Preview
- Grok 4
- Minimax M2.1

### 예제

**같은 LLM**

**Run 1**

```
[STEP title="도함수 구하기"]
\(f(x)=\dfrac{1}{3}x^3-2x^2-12x+4\) 이므로  
\[
f'(x)=x^2-4x-12
\]

[STEP title="임계점(극값 후보) 찾기"]
극대/극소는 \(f'(x)=0\)에서 발생하므로
\[
x^2-4x-12=0
\]
인수분해하면
\[
(x-6)(x+2)=0
\]
따라서 임계점은 \(x=6,\,-2\) 이다.

[STEP title="극대/극소 판별"]
\[
f''(x)=2x-4
\]
- \(x=-2\)에서 \(f''(-2)=2(-2)-4=-8<0\) 이므로 **극대** → \(\alpha=-2\)
- \(x=6\)에서 \(f''(6)=12-4=8>0\) 이므로 **극소** → \(\beta=6\)

[STEP title="차이 계산"]
\[
\beta-\alpha=6-(-2)=8
\]

[FINAL_ANSWER]
\(\beta-\alpha=8\) (⑤)

```

**Run 2**

```
[STEP title="도함수 구하기"]
극값은 도함수 \(f'(x)=0\)인 지점에서 발생합니다.  
\[
f(x)=\frac13 x^3-2x^2-12x+4
\]
\[
f'(x)=x^2-4x-12
\]

[STEP title="임계점(극값 후보) 찾기"]
\[
x^2-4x-12=0
\]
인수분해하면
\[
(x-6)(x+2)=0
\]
따라서 임계점은
\[
x=6,\quad x=-2
\]

[STEP title="극대/극소 판별"]
이차도함수를 이용합니다.
\[
f''(x)=2x-4
\]
- \(x=-2\)에서:
\[
f''(-2)=2(-2)-4=-8<0 \Rightarrow \text{극대}
\]
- \(x=6\)에서:
\[
f''(6)=12-4=8>0 \Rightarrow \text{극소}
\]

따라서
\[
\alpha=-2,\quad \beta=6
\]

[STEP title="요구값 계산"]
\[
\beta-\alpha = 6-(-2)=8
\]

[FINAL_ANSWER]
\(\beta-\alpha=8\) (⑤)

```

**Run 3**

```
[STEP title="도함수 구하기"]
극값은 도함수 \(f'(x)=0\)인 점에서 발생합니다.  
\[
f(x)=\frac13 x^3-2x^2-12x+4
\]
\[
f'(x)=x^2-4x-12
\]

[STEP title="임계점(극값 후보) 구하기"]
\[
x^2-4x-12=0
\]
인수분해하면
\[
(x-6)(x+2)=0
\]
따라서 임계점은
\[
x=6,\quad x=-2
\]

[STEP title="극대/극소 판별"]
이차도함수를 이용합니다.
\[
f''(x)=2x-4
\]
- \(x=-2\)에서  
\[
f''(-2)=2(-2)-4=-8<0 \Rightarrow \text{극대}
\]
따라서 \(\alpha=-2\).

- \(x=6\)에서  
\[
f''(6)=12-4=8>0 \Rightarrow \text{극소}
\]
따라서 \(\beta=6\).

[STEP title="요구값 계산"]
\[
\beta-\alpha=6-(-2)=8
\]

[FINAL_ANSWER]
\[
\beta-\alpha=8 \quad (\text{⑤})
\]

```

**Run 4**

```
[STEP title="도함수 구하기"]
\(f(x)=\dfrac13x^3-2x^2-12x+4\) 이므로  
\[
f'(x)=x^2-4x-12
\]

[STEP title="임계점(극값 후보) 찾기"]
극대/극소는 \(f'(x)=0\)에서 발생하므로
\[
x^2-4x-12=0
\]
\[
(x-6)(x+2)=0
\]
따라서 임계점은 \(x=6,\,-2\) 이다.

[STEP title="극대/극소 판별"]
이차식 \(f'(x)=x^2-4x-12\)는 위로 열린 포물선이므로
- 근 \(-2\)의 왼쪽에서는 \(f'(x)>0\) (증가)
- \(-2\)와 \(6\) 사이에서는 \(f'(x)<0\) (감소)
- \(6\)의 오른쪽에서는 \(f'(x)>0\) (증가)

따라서
- \(x=-2\)에서 증가→감소이므로 **극대**: \(\alpha=-2\)
- \(x=6\)에서 감소→증가이므로 **극소**: \(\beta=6\)

[STEP title="차이 계산"]
\[
\beta-\alpha=6-(-2)=8
\]

[FINAL_ANSWER]
8 (⑤)

```

**Run 5**

```
[STEP title="도함수 구하기"]
\(f(x)=\dfrac{1}{3}x^3-2x^2-12x+4\) 이므로  
\[
f'(x)=x^2-4x-12
\]

[STEP title="임계점(극값 후보) 찾기"]
극대/극소는 \(f'(x)=0\)에서 발생하므로
\[
x^2-4x-12=0
\]
인수분해하면
\[
(x-6)(x+2)=0
\]
따라서 임계점은 \(x=6,\,-2\).

[STEP title="극대/극소 판별"]
이차식 \(f'(x)=x^2-4x-12\)는 위로 열린 포물선이므로, 근 사이에서는 음수이고 근 밖에서는 양수이다.

- \(x<-2\) 에서 \(f'(x)>0\) (증가)
- \(-2<x<6\) 에서 \(f'(x)<0\) (감소)
- \(x>6\) 에서 \(f'(x)>0\) (증가)

따라서
- \(x=-2\)에서 증가 \(\to\) 감소이므로 **극대**: \(\alpha=-2\)
- \(x=6\)에서 감소 \(\to\) 증가이므로 **극소**: \(\beta=6\)

[STEP title="요구값 계산"]
\[
\beta-\alpha = 6-(-2)=8
\]

[FINAL_ANSWER]
8 (⑤)

```

**서로 다른 LLM**

**GPT 5.2**

```

```

**Claude Opus 4.5**

```

```

**Gemini 3 Pro Preview**

```

```

**Grok 4**

```

```

**Minimax M2.1**

```

```

### 전략별 유사도 결과

| 전략 | 7번 평균 유사도 | 22번 평균 유사도 | 다양성 |
| --- | --- | --- | --- |
| 같은 모델 5회 반복 | 0.703 | 0.845 | 낮음 |
| **서로 다른 모델 5종** | **0.279** | **0.343** | **높음** |

⇒ 같은 모델은 temperature를 올려도 거의 같은 풀이를 생성

# 4. 쉬운 문제 vs. 어려운 문제 비교

| 지표 | 7번 (3점) | 22번 (4점) |
| --- | --- | --- |
| v3 step 수 | 4+1 | 6+1 |
| v3 응답 시간 | 4.9s | 26.0s |
| 정답 도달 | 전 모델 정답 | **전 모델 오답** |
| Alignment Group 수 | 4개 | 1개 |
| Step 1:1 대응 | 대부분 가능 | mega-group 형성 |
| Gemini 포맷 준수 | O | **X** |
| Grok 4 응답 시간 | 15.8s | **302.4s** |

---

# 보완 필요

1. 어려운 문제에서 alignment 품질 저하 → 유사도 알고리즘 다양하게 시도 + 유사도 말고 다른 방법 있을지 검토
2. Gemini 등 일부 모델이 output 포맷 때로 미준수 → 재시도 알고리즘?
3. Grok 4 등 일부 모델이 풀이 시간이 매우 오래걸림 → 타임아웃 시키기